@using Pastures2019.Controllers
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResources> SharedLocalizer
@{
    ViewData["Title"] = SharedLocalizer["Charts"];
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/lib/сhart.js/dist/Chart.css" rel="stylesheet" />
<script src="~/lib/сhart.js/dist/Chart.js"></script>

<input id="objectid" type="hidden" value="@ViewBag.objectid" />

<section class="jumbotron text-center p-2">
    <div class="container-fluid">
        <h3 id="valueAllocationNumber"></h3>
        <h5 class="card-title" id="valueOtdel"></h5>
        <p class="lead" id="valuePClass"></p>
        <p class="lead" id="valueGroup"></p>
    </div>
</section>
<div class="container">
    <div class="row align-items-end">
        <div class="col-md-3 order-md-2 mb-4">
            <div class="card bg-light">
                <h6 class="card-header text-muted">@SharedLocalizer["Parameters"]:</h6>
                <div class="card-body p-2">
                    <form>
                        <div class="form-group m-0">
                            <label for="sourceproduct2">@SharedLocalizer["Satellite"]</label>
                            <select class="form-control form-control-sm" id="sourceproduct2">
                                <option value="MOLT_MOD13Q1006">Terra MODIS 16-day</option>
                                <option value="MOLA_MYD13Q1006">Aqua MODIS 16-day</option>
                            </select>
                            <label for="dataset2">@SharedLocalizer["Dataset"]</label>
                            <select class="form-control form-control-sm" id="dataset2">
                                <option value="NDVI">NDVI</option>
                                <option value="Anomaly">@SharedLocalizer["Anomaly"]</option>
                            </select>
                            <label for="monthstart2">@SharedLocalizer["StartMonth"]</label>
                            <select class="form-control form-control-sm" id="monthstart2">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <label for="monthscount2">@SharedLocalizer["NumberOfMonths"]</label>
                            <select class="form-control form-control-sm mb-2" id="monthscount2">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12" selected>12</option>
                            </select>
                            @for (int y = 2000; y <= DateTime.Today.Year; y++)
                            {
                                string checkboxid = "year" + y.ToString();
                                if (y != DateTime.Today.Year)
                                {
                                    <input type="checkbox" id="@checkboxid" name="chart2years" value="@y.ToString()">
                                }
                                else
                                {
                                    <input type="checkbox" id="@checkboxid" name="chart2years" value="@y.ToString()" checked>
                                }
                                <label for="@checkboxid">@y.ToString()</label>
                            }
                            <input type="button" class="btn btn-primary btn-sm btn-block mt-3" onclick="Chart2()" value="@SharedLocalizer["Refresh"]" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-9 order-md-1">
            <nav>
                <div class="nav nav-tabs" id="nav-tabchart2" role="tablist">
                    <a class="nav-item nav-link active" id="nav-chart2-tab" data-toggle="tab" href="#nav-chart2" role="tab" aria-controls="nav-chart2" aria-selected="true">@SharedLocalizer["Chart"]</a>
                    <a class="nav-item nav-link" id="nav-chart2table-tab" data-toggle="tab" href="#nav-chart2table" role="tab" aria-controls="nav-chart2table" aria-selected="false">@SharedLocalizer["Table"]</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-chart2" role="tabpanel" aria-labelledby="nav-chart2-tab">
                    <h5 class="mb-3">@SharedLocalizer["TimeSequence"]</h5>
                    <canvas class="my-4 w-100 chartjs-render-monitor" id="chart2Canvas" width="600" height="400"></canvas>
                </div>
                <div class="tab-pane fade" id="nav-chart2table" role="tabpanel" aria-labelledby="nav-chart2table-tab">
                    <table id="table2" class="table"></table>
                </div>
            </div>
        </div>
    </div>
    <hr class="my-4 border-info">
    @*<div class="row align-items-end">
        <div class="col-md-3 order-md-2 mb-4">
            <div class="card border-dark">
                <h5 class="card-header text-muted">Featured</h5>
                <div class="card-body p-2">
                    <form>
                        <div class="form-group m-0">
                            <label for="sourceproduct1">@SharedLocalizer["Satellite"]</label>
                            <select class="form-control form-control-sm" id="sourceproduct1">
                                <option value="MOLT_MOD13Q1006">Terra MODIS 16-day</option>
                                <option value="MOLA_MYD13Q1006">Aqua MODIS 16-day</option>
                            </select>
                            <label for="dataset1">@SharedLocalizer["Dataset"]</label>
                            <select class="form-control form-control-sm" id="dataset1">
                                <option value="NDVI">NDVI</option>
                                <option value="Anomaly">@SharedLocalizer["Anomaly"]</option>
                            </select>
                            <label for="yearstart1">Starting Years</label>
                            <select class="form-control form-control-sm" id="yearstart1">
                                @for (int y = 2000; y <= DateTime.Today.Year; y++)
                                {
                                    if (y == DateTime.Today.Year)
                                    {
                                        <option value="@y" selected>@y.ToString()</option>
                                    }
                                    else
                                    {
                                        <option value="@y">@y.ToString()</option>
                                    }
                                }
                            </select>
                            <label for="yearstart1">Finishing Years</label>
                            <select class="form-control form-control-sm" id="yearfinish1">
                                @for (int y = 2000; y <= DateTime.Today.Year; y++)
                                {
                                    if (y == DateTime.Today.Year)
                                    {
                                        <option value="@y" selected>@y.ToString()</option>
                                    }
                                    else
                                    {
                                        <option value="@y">@y.ToString()</option>
                                    }
                                }
                            </select>
                            <input type="button" class="btn btn-primary btn-sm btn-block mt-3" onclick="Chart1()" value="@SharedLocalizer["Refresh"]" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-9 order-md-1">
            <nav>
                <div class="nav nav-tabs" id="nav-tabchart1" role="tablist">
                    <a class="nav-item nav-link active" id="nav-chart1-tab" data-toggle="tab" href="#nav-chart1" role="tab" aria-controls="nav-chart1" aria-selected="true">Chart</a>
                    <a class="nav-item nav-link" id="nav-chart1table-tab" data-toggle="tab" href="#nav-chart1table" role="tab" aria-controls="nav-chart1table" aria-selected="false">Table</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-chart1" role="tabpanel" aria-labelledby="nav-chart1-tab">
                    <h5 class="mb-3">Cumulative Time Series</h5>
                    <canvas class="my-4 w-100 chartjs-render-monitor" id="chart1Canvas" width="600" height="400"></canvas>
                </div>
                <div class="tab-pane fade" id="nav-chart1table" role="tabpanel" aria-labelledby="nav-chart1table-tab">
                    <table id="table1" class="table">
                        <tr>
                            <th>
                                @SharedLocalizer["Date"]
                            </th>
                            <th>
                                @SharedLocalizer["minimum"]
                            </th>
                            <th>
                                @SharedLocalizer["maximum"]
                            </th>
                            <th>
                                @SharedLocalizer["median"]
                            </th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <hr class="my-4 border-info">*@
    <div class="row align-items-end">
        <div class="col-md-3 order-md-2 mb-4">
            <div class="card border-dark">
                <h5 class="card-header text-muted">@SharedLocalizer["Parameters"]:</h5>
                <div class="card-body p-2">
                    <form>
                        <div class="form-group m-0">
                            <label for="sourceproduct3">@SharedLocalizer["Satellite"]</label>
                            <select class="form-control form-control-sm" id="sourceproduct3">
                                <option value="MOLT_MOD13Q1006">Terra MODIS 16-day</option>
                                <option value="MOLA_MYD13Q1006">Aqua MODIS 16-day</option>
                            </select>
                            <label for="yearstart3">@SharedLocalizer["StartYear"]</label>
                            <select class="form-control form-control-sm" id="yearstart3">
                                @for (int y = 2000; y <= DateTime.Today.Year; y++)
                                {
                                    if (y == DateTime.Today.Year - 10)
                                    {
                                        <option value="@y" selected>@y.ToString()</option>
                                    }
                                    else
                                    {
                                        <option value="@y">@y.ToString()</option>
                                    }
                                }
                            </select>
                            <label for="yearfinish3">@SharedLocalizer["EndYear"]</label>
                            <select class="form-control form-control-sm" id="yearfinish3">
                                @for (int y = 2000; y <= DateTime.Today.Year; y++)
                                {
                                    if (y == DateTime.Today.Year)
                                    {
                                        <option value="@y" selected>@y.ToString()</option>
                                    }
                                    else
                                    {
                                        <option value="@y">@y.ToString()</option>
                                    }
                                }
                            </select>
                            <label for="type3">@SharedLocalizer["Type"]</label>
                            <select class="form-control form-control-sm" id="type3">
                                <option value="minimum">@SharedLocalizer["minimum"]</option>
                                <option value="maximum">@SharedLocalizer["maximum"]</option>
                                <option value="median">@SharedLocalizer["median"]</option>
                            </select>
                            <input type="button" class="btn btn-primary btn-sm btn-block mt-3" onclick="Chart3()" value="@SharedLocalizer["Refresh"]" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-9 order-md-1">
            <nav>
                <div class="nav nav-tabs" id="nav-tabchart3" role="tablist">
                    <a class="nav-item nav-link active" id="nav-chart3-tab" data-toggle="tab" href="#nav-chart3" role="tab" aria-controls="nav-chart3" aria-selected="true">@SharedLocalizer["Chart"]</a>
                    <a class="nav-item nav-link" id="nav-chart3table-tab" data-toggle="tab" href="#nav-chart3table" role="tab" aria-controls="nav-chart3table" aria-selected="false">@SharedLocalizer["Table"]</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-chart3" role="tabpanel" aria-labelledby="nav-chart3-tab">
                    <h5 class="mb-3">@SharedLocalizer["HistoricalTimeSeries"]</h5>
                    <canvas class="my-4 w-100 chartjs-render-monitor" id="chart31Canvas" width="600" height="400"></canvas>
                    <canvas class="my-4 w-100 chartjs-render-monitor" id="chart32Canvas" width="600" height="400"></canvas>
                </div>
                <div class="tab-pane fade" id="nav-chart3table" role="tabpanel" aria-labelledby="nav-chart3table-tab">
                    <table id="table3" class="table"></table>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    var chart1 = null;
    function Chart1() {
        $('#valueAllocationNumber').text('@Html.Raw(SharedLocalizer["AllocationNumber"]): @Html.Raw(ViewBag.pasturepol.group_id)' + '. ');
        $('#valueOtdel').text('@Html.Raw(SharedLocalizer["Otdel"]): @Html.Raw(ViewBag.pasturepol.otdel)' + '. ');
        $('#valuePClass').text('@Html.Raw(SharedLocalizer["PClass"]): @Html.Raw(ViewBag.pasturepol.ptype)' + '. ');
        $('#valueGroup').html('@Html.Raw(SharedLocalizer["Group"]): @Html.Raw(ViewBag.pasturepol.group)' + ' (' + '<em>@Html.Raw(ViewBag.pasturepol.group_lat)</em>' + ')');
        $.ajax({
            url: '@Url.Action("GetChart1Data")',
            data: {
                objectid: $('#objectid').val(),
                sourceproduct: $('#sourceproduct1').val(),
                dataset: $('#dataset1').val(),
                yearstart: $('#yearstart1').val(),
                yearfinish: $('#yearfinish1').val()
            },
            type: 'POST',
            success: function (data) {
                var chart1Data = {
                    labels: data.labels,
                    datasets: [
                        {
                            label: '@Html.Raw(SharedLocalizer["median"])',
                            backgroundColor: 'rgba(100, 170, 43, 1)',
                            data: data.years_median
                        }]
                };
                var ctx1 = document.getElementById('chart1Canvas').getContext('2d');
                if (chart1 != null) {
                    chart1.destroy();
                }
                chart1 = new Chart(ctx1, {
                    type: 'bar',
                    data: chart1Data,
                    options: {
                        responsive: true,
                        scales: {
                            xAxes: [{
                                gridLines: {
                                   display: false,
                                }                                
                            }],
                            yAxes: [{                               
                                ticks: {
                                    max: 0.8,
                                    min: 0,
                                    stepSize: 0.2
                                }
                            }]
                        },
                        title: {
                            display: true,
                            fontSize: 14,
                            fontFamily: 'Arial',
                            fontColor: '#1A1A1A',
                            fontStyle: 'bold',                            
                            text: [$('#sourceproduct2 option:selected').text() + ', ' + $('#dataset2 option:selected').text() + '. ']
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                fontColor: 'rgb(26, 26, 26)'
                            }
                        }
                    }
                });

                $('#table1 tr').not(':first').remove();
                var html = '';
                for (var i = 0; i < data.labels.length; i++) {
                    html += '<tr><td>' + data.labels[i]
                        + '</td><td>' + data.years_min[i]
                        + '</td><td>' + data.years_max[i]
                        + '</td><td>' + data.years_median[i] + '</td></tr>';
                }
                $('#table1 tr').first().after(html);
            },
            error: function () {
                console.log('Error chart 1');
            }
        });
    }

    var chart2 = null;
    function Chart2() {
        var chart2years = [];
        $("input:checkbox[name=chart2years]:checked").each(function(){
            chart2years.push($(this).val());
        });
        $.ajax({
            url: '@Url.Action("GetChart2Data")',
            data: {
                objectid: $('#objectid').val(),
                sourceproduct: $('#sourceproduct2').val(),
                dataset: $('#dataset2').val(),
                monthstart: $('#monthstart2').val(),
                monthscount: $('#monthscount2').val(),
                years: chart2years
            },
            type: 'POST',
            success: function (data) {
                var chart2Data = {
                    labels: data.labels,
                    datasets: [
                        {
                            label: '@Html.Raw(SharedLocalizer["minimum"])',
                            borderColor: 'rgba(212, 212, 212, 1)',
                            borderWidth: 1,
                            data: data.years_min,
                            fill: "+1"
                        },
                        {
                            label: '@Html.Raw(SharedLocalizer["maximum"])',
                            borderColor: 'rgba(212, 212, 212, 3)',
                            borderWidth: 1,
                            data: data.years_max,
                            fill: false
                        },
                        {
                            label: '@Html.Raw(SharedLocalizer["median"])',
                            borderColor: 'rgba(0, 0, 0, 1)',
                            borderWidth: 4,
                            data: data.years_median,
                            fill: false
                        }]
                };                
                for (var i = 0; i < data.year_median_datasets.length; ++i) {
                    var color = random_rgba();
                    chart2Data.datasets.push({
                        label: data.year_median_datasets[i].year + ' @Html.Raw(SharedLocalizer["median"])',
                        backgroundColor: color,
                        borderColor: color,
                        data: data.year_median_datasets[i].data,
                        fill: false
                    });
                }
                var ctx2 = document.getElementById('chart2Canvas').getContext('2d');
                if (chart2 != null) {
                    chart2.destroy();
                }
                chart2 = new Chart(ctx2, {
                    type: 'line',
                    data: chart2Data,
                    options: {
                        responsive: true,
                        elements: {
                            point: {
                                radius: 0
                            }
                        },
                        title: {
                            display: true,
                            fontSize: 14,
                            fontFamily: 'Arial',
                            fontColor: '#1A1A1A',
                            fontStyle: 'bold',                            
                            text: [$('#sourceproduct2 option:selected').text() + ', ' + $('#dataset2 option:selected').text() + '. ']
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                fontColor: 'rgb(26, 26, 26)'
                            }
                        },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    max: 1,
                                    min: -0.2,
                                    stepSize: 0.2
                                }
                            }],
                            xAxes: [{
                                gridLines: {
                                   display: false,
                                },
                            }]
                        }
                    }
                });

                $('#table2 tr').remove();
                var html = '<tr><th>@SharedLocalizer["Date"]'
                    + '</th><th>@SharedLocalizer["minimum"]'
                    + '</th><th>@SharedLocalizer["maximum"]'
                    + '</th><th>@SharedLocalizer["median"]';
                for (var i = 0; i < data.year_min_datasets.length; ++i) {
                    html += '</th><th>' + data.year_min_datasets[i].year + ' @Html.Raw(SharedLocalizer["minimum"])';
                }
                for (var i = 0; i < data.year_max_datasets.length; ++i) {
                    html += '</th><th>' + data.year_max_datasets[i].year + ' @Html.Raw(SharedLocalizer["maximum"])';
                }
                for (var i = 0; i < data.year_median_datasets.length; ++i) {
                    html += '</th><th>' + data.year_median_datasets[i].year + ' @Html.Raw(SharedLocalizer["median"])';
                }
                html += '</th></tr>'
                for (var i = 0; i < data.labels.length; i++) {
                    html += '<tr><td>' + data.labels[i]
                        + '</td><td>' + data.years_min[i]
                        + '</td><td>' + data.years_max[i]
                        + '</td><td>' + data.years_median[i];
                    for (var j = 0; j < data.year_min_datasets.length; ++j) {
                        html += '</td><td>' + (data.year_min_datasets[j].data[i] == null ? '' : data.year_min_datasets[j].data[i]);
                    }
                    for (var j = 0; j < data.year_max_datasets.length; ++j) {
                        html += '</td><td>' + (data.year_max_datasets[j].data[i] == null ? '' : data.year_max_datasets[j].data[i]);
                    }
                    for (var j = 0; j < data.year_median_datasets.length; ++j) {
                        html += '</td><td>' + (data.year_median_datasets[j].data[i] == null ? '' : data.year_median_datasets[j].data[i]);
                    }
                    html += '</td></tr>';
                }
                $('#table2').append(html);
            },
            error: function () {
                console.log('Error chart 2');
            }
        });
    }

    var chart31 = null,
        chart32 = null;
    function Chart3() {
        $.ajax({
            url: '@Url.Action("GetChart3Data")',
            data: {
                objectid: $('#objectid').val(),
                sourceproduct: $('#sourceproduct3').val(),
                yearstart: $('#yearstart3').val(),
                yearfinish: $('#yearfinish3').val()
            },
            type: 'POST',
            success: function (data) {
                var color = random_rgba(),
                    color_avg = random_rgba();
                var chart31Data = {};
                if ($('#type3').val() == 'minimum') {
                    chart31Data = {
                        labels: data.labelsx,
                        datasets: [
                            {
                                type: 'line',
                                label: '@Html.Raw(SharedLocalizer["minimum"]) (@Html.Raw(SharedLocalizer["average"]))',
                                backgroundColor: color_avg,
                                borderColor: color_avg,
                                borderWidth: 2,
                                data: data.years_avg_min,
                                fill: false
                            },
                            {
                                type: 'bar',
                                label: '@Html.Raw(SharedLocalizer["minimum"])',
                                backgroundColor: color,
                                borderColor: 'rgba(215, 215, 215, 1)',
                                borderWidth: 1,
                                data: data.years_min
                            }
                        ]
                    };
                }
                else if ($('#type3').val() == 'maximum') {
                    chart31Data = {
                        labels: data.labelsx,
                        datasets: [
                            {
                                type: 'line',
                                label: '@Html.Raw(SharedLocalizer["maximum"]) (@Html.Raw(SharedLocalizer["average"]))',
                                backgroundColor: color_avg,
                                borderColor: color_avg,
                                borderWidth: 2,
                                data: data.years_avg_max,
                                fill: false
                            },
                            {
                                type: 'bar',
                                label: '@Html.Raw(SharedLocalizer["maximum"])',
                                backgroundColor: color,
                                borderColor: 'rgba(215, 215, 215, 1)',
                                borderWidth: 1,
                                data: data.years_max
                            }
                        ]
                    };
                }
                else if ($('#type3').val() == 'median') {
                    chart31Data = {
                        labels: data.labelsx,
                        datasets: [
                            {
                                type: 'line',
                                label: '@Html.Raw(SharedLocalizer["median"]) (@Html.Raw(SharedLocalizer["average"]))',
                                backgroundColor: color_avg,
                                borderColor: color_avg,
                                borderWidth: 2,
                                data: data.years_avg_median,
                                fill: false
                            },
                            {
                                type: 'bar',
                                label: '@Html.Raw(SharedLocalizer["median"])',
                                backgroundColor: color,
                                borderColor: 'rgba(215, 215, 215, 1)',
                                borderWidth: 1,
                                data: data.years_median
                            }]
                    };
                }
                var ctx31 = document.getElementById('chart31Canvas').getContext('2d');
                if (chart31 != null) {
                    chart31.destroy();
                }
                chart31 = new Chart(ctx31, {
                    type: 'bar',
                    data: chart31Data,
                    options: {
                        responsive: true,
                        scales: {
                            xAxes: [{
                                stacked: true,
                                ticks: {
                                    autoSkip : false,
                                    callback: function (value, index, values) {
                                        if (value == '') {
                                            return null;
                                        }
                                        else {
                                            return value;
                                        }
                                    }
                                }
                            }],
                            yAxes: [{
                                stacked: true
                            }]
                        },
                        title: {
                            display: true,
                            text: [$('#sourceproduct3 option:selected').text() + ', NDVI. ',
                            '@Html.Raw(SharedLocalizer["AllocationNumber"]): @Html.Raw(ViewBag.pasturepol.group_id)' + '. ']
                        },
                        tooltips: {
                            callbacks: {
                                title: function (tooltipItem, datac) {
                                    return data.labels[tooltipItem[0].index];
                                }
                            }
                        }
                    }
                });

                var chart32Data = {};
                var color_a = [];
                if ($('#type3').val() == 'minimum') {
                    for (i = 0; i < data.years_min_a.length; i++) {
                        if (data.years_min_a[i] > 0) {
                            color_a.push('rgba(0, 215, 0, 1)');
                        }
                        else {
                            color_a.push('rgba(215, 0, 0, 1)')
                        }
                    }
                    chart32Data = {
                        labels: data.labelsx,
                        datasets: [
                            {
                                label: '@Html.Raw(SharedLocalizer["minimum"])',
                                backgroundColor: color_a,
                                borderColor: 'rgba(215, 215, 215, 1)',
                                borderWidth: 1,
                                data: data.years_min_a,

                            }
                        ]
                    };
                }
                else if ($('#type3').val() == 'maximum') {
                    for (i = 0; i < data.years_max_a.length; i++) {
                        if (data.years_max_a[i] > 0) {
                            color_a.push('rgba(0, 215, 0, 1)');
                        }
                        else {
                            color_a.push('rgba(215, 0, 0, 1)')
                        }
                    }
                    chart32Data = {
                        labels: data.labelsx,
                        datasets: [
                            {
                                label: '@Html.Raw(SharedLocalizer["maximum"])',
                                backgroundColor: color_a,
                                borderColor: 'rgba(215, 215, 215, 1)',
                                borderWidth: 1,
                                data: data.years_max_a
                            }
                        ]
                    };
                }
                else if ($('#type3').val() == 'median') {
                    for (i = 0; i < data.years_median_a.length; i++) {
                        if (data.years_median_a[i] > 0) {
                            color_a.push('rgba(0, 215, 0, 1)');
                        }
                        else {
                            color_a.push('rgba(215, 0, 0, 1)')
                        }
                    }
                    chart32Data = {
                        labels: data.labelsx,
                        datasets: [
                            {
                                label: '@Html.Raw(SharedLocalizer["median"])',
                                backgroundColor: color_a,
                                borderColor: 'rgba(215, 215, 215, 1)',
                                borderWidth: 1,
                                data: data.years_median_a
                            }]
                    };
                }

                var ctx32 = document.getElementById('chart32Canvas').getContext('2d');
                if (chart32 != null) {
                    chart32.destroy();
                }
                chart32 = new Chart(ctx32, {
                    type: 'bar',
                    data: chart32Data,
                    options: {
                        responsive: true,
                        scales: {
                            xAxes: [{
                                stacked: true,
                                ticks: {
                                    autoSkip : false,
                                    callback: function (value, index, values) {
                                        if (value == '') {
                                            return null;
                                        }
                                        else {
                                            return value;
                                        }
                                    }
                                }
                            }],
                            yAxes: [{
                                stacked: true
                            }]
                        },
                        title: {
                            display: true,
                            text: [$('#sourceproduct3 option:selected').text() + ', @Html.Raw(SharedLocalizer["Anomaly"]). ']
                        },
                        tooltips: {
                            callbacks: {
                                title: function (tooltipItem, datac) {
                                    return data.labels[tooltipItem[0].index];
                                }
                            }
                        }
                    }
                });

                $('#table3 tr').remove();
                var html = '<tr><th>@SharedLocalizer["Date"]'
                    + '</th><th>NDVI ' + $("#type3 option:selected").text() + ' (@SharedLocalizer["average"])'
                    + '</th><th>NDVI ' + $("#type3 option:selected").text()
                    + '</th><th>@SharedLocalizer["Anomaly"] ' + $("#type3 option:selected").text() + '</th></tr>';
                for (var i = 0; i < data.labels.length; i++) {
                    if ($('#type3').val() == 'minimum') {
                        html += '<tr><td>' + data.labels[i]
                            + '</td><td>' + data.years_avg_min[i]
                            + '</td><td>' + data.years_min[i]
                            + '</td><td>' + data.years_min_a[i] + '</td></tr>';
                    }
                    else if ($('#type3').val() == 'maximum') {
                        html += '<tr><td>' + data.labels[i]
                            + '</td><td>' + data.years_avg_max[i]
                            + '</td><td>' + data.years_max[i]
                            + '</td><td>' + data.years_max_a[i] + '</td></tr>';
                    }
                    else if ($('#type3').val() == 'median') {
                        html += '<tr><td>' + data.labels[i]
                            + '</td><td>' + data.years_avg_median[i]
                            + '</td><td>' + data.years_median[i]
                            + '</td><td>' + data.years_median_a[i] + '</td></tr>';
                    }
                }
                $('#table3').append(html);
            },
            error: function () {
                console.log('Error chart 3');
            }
        });
    }

    function random_rgba() {
        var o = Math.round, r = Math.random, s = 255;
        //return 'rgba(' + o(r() * s) + ',' + o(r() * s) + ',' + o(r() * s) + ',' + r().toFixed(1) + ')';
        return 'rgba(' + o(r() * s) + ',' + o(r() * s) + ',' + o(r() * s) + ',1)';
    }
</script>

<script>
    $(document).ready(function () {
        //Chart1();
        Chart2();
        Chart3();
    });
</script>