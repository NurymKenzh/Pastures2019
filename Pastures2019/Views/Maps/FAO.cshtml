@using Pastures2019.Controllers
@using Microsoft.AspNetCore.Localization
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResources> SharedLocalizer
@{
    ViewData["Title"] = SharedLocalizer["FAO"];
    Layout = "~/Views/Shared/_LayoutMap.cshtml";
}
@await Html.PartialAsync("_StylesTabAndShart")

<link href="~/lib/ol/ol.css" rel="stylesheet" />
<link rel="stylesheet" href="~/lib/vendor/font-awesome/css/font-awesome.min.css" />
<script src="~/lib/ol/ol.js"></script>
<link href="~/lib/vendor/jBox/dist/jBox.all.css" rel="stylesheet" />
<script src="~/lib/vendor/jBox/dist/jBox.all.js"></script>
<link href="~/lib/сhart.js/dist/Chart.css" rel="stylesheet" />
<script src="~/lib/сhart.js/dist/Chart.js"></script>

<div class="container-fluid sticky-top p-0">
    <!-- Sidebar -->
    <nav class="sidebar border border-light overflow-auto">
        <div class="page-wrapper">
            <!-- close sidebar menu -->
            <div class="dismiss">
                <i class="fa fa-arrow-left"></i>
            </div>
            <div class="logo">
                <h3><a href="#">Gis-Pasture</a></h3>
            </div>
            <!-- Other sections -->
            <ul class="list-unstyled menu-elements">
                <li>
                    <a href="#FindKATOSections" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle" role="button" aria-controls="FindKATOSections">
                        <i class="fa fa-search"></i>@SharedLocalizer["TerritorySearch"]
                    </a>
                    <div id="FindKATOSections" class="collapse show" aria-labelledby="headingOne" data-parent="#FindKATOSections">
                        <div class="col">
                            <form>
                                <div class="form-group mb-0">
                                    <label class="m-0" for="catosearch1">@SharedLocalizer["Areas"]</label>
                                    <select class="form-control form-control-sm" id="catosearch1" onchange="ChangeCATOsearch1()"></select>
                                </div>
                                <div class="form-group mb-0">
                                    <label for="catosearch2" class="m-0">@SharedLocalizer["Districts"]</label>
                                    <select class="form-control form-control-sm" id="catosearch2" onchange="ChangeCATOsearch2()"></select>
                                </div>
                                <div class="form-group">
                                    <label for="catosearch3" class="m-0">@SharedLocalizer["RuralCounties"]</label>
                                    <select class="form-control form-control-sm" id="catosearch3" onchange="ChangeCATOsearch3()"></select>
                                </div>
                            </form>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="#TematicLayerSections" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle" role="button" aria-controls="TematicLayerSections">
                        <i class="fa fa-list"></i>@SharedLocalizer["BaseLayers"]
                    </a>
                    <div id="TematicLayerSections" class="collapse collapse show" aria-labelledby="headingOne" data-parent="#TematicLayerSections">
                        <div class="card-body">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layerpas19Show" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layerpas19Show">
                                    ТОО «Зингибаба»
                                </label>
                                <input id="layerpas19Opacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />

                                <input class="form-check-input" type="checkbox" id="layern_19Show" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layern_19Show">
                                    @SharedLocalizer["Condition"]
                                </label>
                                <input id="layern_19Opacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                                <select class="form-control form-control-sm" id="n_19_date" onchange="ChangeLayers()">
                                    <option value="n_19_20190506">2019-05-06</option>
                                    <option value="n_19_20190918">2019-09-08</option>
                                </select>
                            </div>
                            <hr />
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layerpas63Show" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layerpas63Show">
                                    к/х «Бексултан»
                                </label>
                                <input id="layerpas63Opacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />

                                <input class="form-check-input" type="checkbox" id="layern_63Show" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layern_63Show">
                                    @SharedLocalizer["Condition"]
                                </label>
                                <input id="layern_63Opacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                                <select class="form-control form-control-sm" id="n_63_date" onchange="ChangeLayers()">
                                    <option value="n_63_20190413">2019-04-13</option>
                                    <option value="n_63_20190801">2019-08-01</option>
                                </select>
                            </div>
                            <hr />
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layerpopShow" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layerpopShow">
                                    @SharedLocalizer["popLayer"]
                                </label>
                                <input id="layerpopOpacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layeradmxpolShow" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layeradmxpolShow">
                                    @SharedLocalizer["admxpolLayer"]
                                </label>
                                <input id="layeradmxpolOpacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layerhdrShow" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layerhdrShow">
                                    @SharedLocalizer["hdrLayer"]
                                </label>
                                <input id="layerhdrOpacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="layerrdslinShow" checked="checked" onchange="ChangeLayers()">
                                <label class="form-check-label" for="layerrdslinShow">
                                    @SharedLocalizer["rdslinLayer"]
                                </label>
                                <input id="layerrdslinOpacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                            </div>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="#BaseLayerSections" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle" role="button" aria-controls="BaseLayerSections">
                        <i class="fa fa-refresh"></i>@SharedLocalizer["BackgroundLayers"]
                    </a>
                    <div id="BaseLayerSections" class="collapse collapse in" aria-labelledby="headingOne" data-parent="#BaseLayerSections">
                        <div class="card-body">
                            <div class="input-group input-group-sm">
                                <select class="custom-select" id="layerBaseType" onchange="ChangeLayers()">
                                    <option value="OSM" selected>OpenStreetMap</option>
                                    <option value="BingAerialWithLabels">Bing Aerial</option>
                                    <option value="BingRoadStatic">Bing Road (static)</option>
                                    <option value="BingRoadDynamic">Bing Road (dynamic)</option>
                                    <option value="HERENormalDay">HERE Normal Day</option>
                                    <option value="HERENormalDayTransit">HERE Normal Day Transit</option>
                                    <option value="HERETerrainDay">HERE Terrain Day</option>
                                    <option value="HEREHybridDay">HERE Hybrid Day</option>
                                    <option value="StamenWatercolor">Stamen Watercolor</option>
                                    <option value="StamenTerrain">Stamen Terrain</option>
                                    <option value="StamenToner">Stamen Toner</option>
                                    <option value="ArcGIS">ArcGIS</option>
                                    <option value="ThunderforestOpenCycleMap">Thunderforest OpenCycleMap</option>
                                    <option value="ThunderforestTransport">Thunderforest Transport</option>
                                    <option value="ThunderforestLandscape">Thunderforest Landscape</option>
                                    <option value="ThunderforestOutdoors">Thunderforest Outdoors</option>
                                    <option value="ThunderforestSpinalMap">Thunderforest Spinal Map</option>
                                    <option value="ThunderforestPioneer">Thunderforest Pioneer</option>
                                    <option value="ThunderforestMobileAtlas">Thunderforest Mobile Atlas</option>
                                    <option value="ThunderforestNeighbourhood">Thunderforest Neighbourhood</option>
                                </select>
                                <div class="input-group-append">
                                    <div class="input-group-text">
                                        <input type="checkbox" id="layerBaseShow" checked="checked" onchange="ChangeLayers()">
                                    </div>
                                </div>
                            </div>
                            <input id="layerBaseOpacity" type="range" class="form-control-range" min="0" max="100" value="100" oninput="ChangeLayers()" />
                        </div>
                    </div>
                </li>
            </ul>
            <!-- Exaple 1 -->
            <div class="card-body">
                <div class="table-responsive-sm" style="display: none" id="InfoMap">
                    <table class="table table-striped table-hover table-sm small" id="InfoTableContent">
                        <tbody>
                            <tr>
                                <th scope="row" id="infoGroupLat">@SharedLocalizer["GroupLat"]</th>
                                <td class="font-italic" colspan="2" id="valueGroupLat"></td>
                            </tr>
                            <tr class="table-active">
                                <th scope="row" id="infoAllocatedFeedResources">@SharedLocalizer["AllocatedFeedResources"]</th>
                                <td id="infocha">@SharedLocalizer["cha"]</td>
                            </tr>
                            <tr>
                                <th scope="row" id="infoSpring">@SharedLocalizer["Spring"]</th>
                                <td class="font-italic" id="valueUr_v"></td>
                            </tr>
                            <tr>
                                <th scope="row" id="infoSummer">@SharedLocalizer["Summer"]</th>
                                <td class="font-italic" id="valueUr_l"></td>
                            </tr>
                            <tr>
                                <th scope="row" id="infoAutumn">@SharedLocalizer["Autumn"]</th>
                                <td class="font-italic" id="valueUr_o"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="table-responsive-sm" style="display: none" id="InfoMapDegradation">
                    <table class="table table-striped table-hover table-sm small" id="InfoTableContentDegradation">
                        <tbody>
                            <tr>
                                <th class="font-italic" colspan="2" scope="row">@SharedLocalizer["DegradationFieldTitle"]</th>
                            </tr>
                            <tr>
                                <th scope="row" id="infoSpring">@SharedLocalizer["YieldBefore"]</th>
                                <td class="font-italic" id="YieldBefore"></td>
                            </tr>
                            <tr>
                                <th scope="row" id="infoSummer">@SharedLocalizer["YieldAfter"]</th>
                                <td class="font-italic" id="YieldAfter"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="chiller-theme">
            <div class="sidebar-footer">
                <a href="#">
                    <i class="SomeInfo fa fa-home" InfoTitle="@SharedLocalizer["ToHome"]" onclick="ToHome()"></i>
                </a>
                <a href="#" id="InfoBtn" class="target-click">
                    <i class="SomeInfo fa fa-info-circle" InfoTitle="@SharedLocalizer["ClickOnAPlaceOnTheMapToGetInformationAboutObjects"]"></i>
                </a>
            </div>
        </div>
    </nav>
    <!-- End sidebar -->
    <!-- Content -->
    <div class="content">
        <!-- open sidebar menu -->
        <a class="btn btn-light btn-customized open-menu" href="#" role="button">
            <i class="fa fa-align-left"></i> <span>@SharedLocalizer["Menu"]</span>
        </a>
        <!-- Map content -->
        <div id="map" class="position-fixed col-md-12 ml-sm-auto col-lg-12 p-0" style="height: calc(100% - 100px);"></div>
    </div>
    <!-- End content -->
    <footer class="footer-classic fixed-bottom border-top border-light">
        <div class="container-fluid">
            <div class="row align-items-center m-1">
                <div class="col">
                    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                        <div class="btn-group mr-2" role="group" aria-label="Third group">
                            <button id="HomeBtn" type="button" class="btn btn-outline-primary btn-sm"><i class="SomeInfo fa fa-home" InfoTitle="@SharedLocalizer["ToHome"]" onclick="ToHome()"></i></button>
                        </div>
                        <div class="btn-group mr-2" role="group" aria-label="Four group">
                            <button id="LegendBtn2" type="button" class="btn btn-outline-primary btn-sm"><i class="SomeInfo fa fa-list-alt" InfoTitle="@SharedLocalizer["Legend"]"></i></button>
                        </div>
                    </div>
                </div>
                <div class="col-md-auto">
                    <div class="float-right">
                        <!--LiveInternet counter--><a href="//www.liveinternet.ru/click"
                                                      target="_blank">
                            <img id="licnt1C2F" width="16" height="16" style="border:0"
                                 title="LiveInternet"
                                 src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7"
                                 alt="" />
                        </a>
                        <script>
                            (function (d, s) {
                                d.getElementById("licnt1C2F").src =
                                    "//counter.yadro.ru/hit?t44.12;r" + escape(d.referrer) +
                                    ((typeof (s) == "undefined") ? "" : ";s" + s.width + "*" + s.height + "*" +
                                        (s.colorDepth ? s.colorDepth : s.pixelDepth)) + ";u" + escape(d.URL) +
                                    ";h" + escape(d.title.substring(0, 150)) + ";" + Math.random()
                            })
                                (document, screen)</script><!--/LiveInternet-->
                        &copy; @DateTime.Now.Year.ToString() - КазНИИЖиК
                    </div>
                </div>
                <div class="col col-lg-2">
                    @await Html.PartialAsync("_SelectLanguagePartial")
                </div>
            </div>

        </div>
    </footer>
</div>

@* legend *@
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    string culture = requestCulture.RequestCulture.UICulture.Name,
        legendhtml = "<div class='p-0'><img id='legend' class='card-img-top' src='/images/Legends/faoru.jpg'></div>";
    if(culture == "en")
    {
        legendhtml = "<div class='p-0'><img id='legend' class='card-img-top' src='/images/Legends/faoen.jpg'></div>";
    }
    else if(culture == "kk")
    {
        legendhtml = "<div class='p-0'><img id='legend' class='card-img-top' src='/images/Legends/faokk.jpg'></div>";
    }
}

@* base layers *@
<script>
    var HEREappId = 'SLdBasp4s1oq2oUbVGxy';
    var HEREappCode = 'D9-h9iVhjgUB_9eUlFETXA';

    var Source_OSM = new ol.source.OSM();
    Source_BingAerialWithLabels = new ol.source.BingMaps({
        key: 'AmYNYRGlIrw_kppWvrIhfzY1v046b4Ft5nopz6Av94XDvTTo8xTkHCEaZ_zMwCOJ',
        imagerySet: 'AerialWithLabels',
    });
    Source_BingRoadStatic = new ol.source.BingMaps({
        key: 'AmYNYRGlIrw_kppWvrIhfzY1v046b4Ft5nopz6Av94XDvTTo8xTkHCEaZ_zMwCOJ',
        imagerySet: 'Road',
    });
    Source_BingRoadDynamic = new ol.source.BingMaps({
        key: 'AmYNYRGlIrw_kppWvrIhfzY1v046b4Ft5nopz6Av94XDvTTo8xTkHCEaZ_zMwCOJ',
        imagerySet: 'RoadOnDemand',
    });
    var urlTpl = 'https://{1-4}.{base}.maps.cit.api.here.com' +
        '/{type}/2.1/maptile/newest/{scheme}/{z}/{x}/{y}/256/png' +
        '?app_id={app_id}&app_code={app_code}';
    function HEREcreateUrl(tpl, HERElayerDesc) {
        return tpl
            .replace('{base}', HERElayerDesc.base)
            .replace('{type}', HERElayerDesc.type)
            .replace('{scheme}', HERElayerDesc.scheme)
            .replace('{app_id}', HERElayerDesc.app_id)
            .replace('{app_code}', HERElayerDesc.app_code);
    };
    var HERElayerDescNormalDay = {
        base: 'base',
        type: 'maptile',
        scheme: 'normal.day',
        app_id: HEREappId,
        app_code: HEREappCode
    };
    var Source_HERENormalDay = new ol.source.XYZ({
        url: HEREcreateUrl(urlTpl, HERElayerDescNormalDay),
        attributions: 'Map Tiles &copy; ' + new Date().getFullYear() + ' ' +
            '<a href="http://developer.here.com">HERE</a>'
    });
    var HERElayerDescNormalDayTransit = {
        base: 'base',
        type: 'maptile',
        scheme: 'normal.day.transit',
        app_id: HEREappId,
        app_code: HEREappCode
    };
    var Source_HERENormalDayTransit = new ol.source.XYZ({
        url: HEREcreateUrl(urlTpl, HERElayerDescNormalDayTransit),
        attributions: 'Map Tiles &copy; ' + new Date().getFullYear() + ' ' +
            '<a href="http://developer.here.com">HERE</a>'
    });
    var HERElayerDescTerrainDay = {
        base: 'aerial',
        type: 'maptile',
        scheme: 'terrain.day',
        app_id: HEREappId,
        app_code: HEREappCode
    };
    var Source_HERETerrainDay = new ol.source.XYZ({
        url: HEREcreateUrl(urlTpl, HERElayerDescTerrainDay),
        attributions: 'Map Tiles &copy; ' + new Date().getFullYear() + ' ' +
            '<a href="http://developer.here.com">HERE</a>'
    });
    var HERElayerDescHybridDay = {
        base: 'aerial',
        type: 'maptile',
        scheme: 'hybrid.day',
        app_id: HEREappId,
        app_code: HEREappCode
    };
    var Source_HEREHybridDay = new ol.source.XYZ({
        url: HEREcreateUrl(urlTpl, HERElayerDescHybridDay),
        attributions: 'Разработка &copy;' + '<a href="http://kazniizhik.kz/">КазНИИЖиК</a>' + ' & Map Tiles &copy; ' + new Date().getFullYear() + ' ' + '<a href="http://developer.here.com">HERE</a>'
    });
    var Source_StamenWatercolor = new ol.source.Stamen({
        layer: 'watercolor'
    });
    var Source_StamenTerrain = new ol.source.Stamen({
        layer: 'terrain'
    });
    var Source_StamenToner = new ol.source.Stamen({
        layer: 'toner'
    });
    var Source_ArcGIS = new ol.source.XYZ({
        attributions: 'Tiles © <a href="https://services.arcgisonline.com/ArcGIS/' +
            'rest/services/World_Topo_Map/MapServer">ArcGIS</a>',
        url: 'https://server.arcgisonline.com/ArcGIS/rest/services/' +
            'World_Topo_Map/MapServer/tile/{z}/{y}/{x}'
    });
    var Source_ThunderforestOpenCycleMap = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestTransport = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/transport/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestLandscape = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestOutdoors = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestTransportDark = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestSpinalMap = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/spinal-map/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestPioneer = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestMobileAtlas = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Source_ThunderforestNeighbourhood = new ol.source.XYZ({
        url: 'https://{a-c}.tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png' +
            '?apikey=6746f4299ea3479aba8726b09f049c1b'
    });
    var Layer_Base = new ol.layer.Tile({
        source: Source_OSM
    });
    Layer_Base.set('name', 'Base');
    Layer_Base.setOpacity(1);
</script>

@* layers *@
<script>
    var geoserver_url = '@ViewBag.GeoServerUrl',
        geoserver_workspace_name = 'Pastures2019';

    var url_adm1pol = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_adm1pol = new ol.source.TileWMS({
        url: url_adm1pol,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':adm1pol'
        },
        serverType: 'geoserver'
    });
    var Layer_adm1pol = new ol.layer.Tile({
        source: Source_adm1pol
    });
    Layer_adm1pol.set('name', 'admxpol');
    Layer_adm1pol.setVisible(false);

    var url_adm2pol = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_adm2pol = new ol.source.TileWMS({
        url: url_adm2pol,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':adm2pol'
        },
        serverType: 'geoserver'
    });
    var Layer_adm2pol = new ol.layer.Tile({
        source: Source_adm2pol
    });
    Layer_adm2pol.set('name', 'admxpol');
    Layer_adm2pol.setVisible(false);

    var url_adm3pol = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_adm3pol = new ol.source.TileWMS({
        url: url_adm3pol,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':adm3pol'
        },
        serverType: 'geoserver'
    });
    var Layer_adm3pol = new ol.layer.Tile({
        source: Source_adm3pol
    });
    Layer_adm3pol.set('name', 'admxpol');
    Layer_adm3pol.setVisible(false);

    var Layer_admXpol_Navigate = new ol.layer.Vector({
        style: new ol.style.Style({
            fill: new ol.style.Fill({
                color: 'transparent'
            }),
            stroke: new ol.style.Stroke({
                color: 'red',
                width: 4
            })
        })
    });
    Layer_admXpol_Navigate.set('name', 'admxpolnavigate');

    var url_hdrlin = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_hdrlin = new ol.source.TileWMS({
        url: url_hdrlin,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':hdrlin'
        },
        serverType: 'geoserver'
    });
    var Layer_hdrlin = new ol.layer.Tile({
        source: Source_hdrlin,
        maxResolution: ol.tilegrid.createXYZ().getResolution(7)
    });
    Layer_hdrlin.set('name', 'hdr');

    var url_hdrpol = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_hdrpol = new ol.source.TileWMS({
        url: url_hdrpol,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':hdrpol'
        },
        serverType: 'geoserver'
    });
    var Layer_hdrpol = new ol.layer.Tile({
        source: Source_hdrpol
    });
    Layer_hdrpol.set('name', 'hdr');

    var url_poppnt = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_poppnt = new ol.source.TileWMS({
        url: url_poppnt,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':poppnt'
        },
        serverType: 'geoserver'
    });
    var Layer_poppnt = new ol.layer.Tile({
        source: Source_poppnt,
        maxResolution: ol.tilegrid.createXYZ().getResolution(9)
    });
    Layer_poppnt.set('name', 'pop');

    var url_poppol = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_poppol = new ol.source.TileWMS({
        url: url_poppol,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':poppol'
        },
        serverType: 'geoserver'
    });
    var Layer_poppol = new ol.layer.Tile({
        source: Source_poppol
    });
    Layer_poppol.set('name', 'pop');

    var url_rdslin = geoserver_url + geoserver_workspace_name + '/wms';
    var Source_rdslin = new ol.source.TileWMS({
        url: url_rdslin,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':rdslin'
        },
        serverType: 'geoserver'
    });
    var Layer_rdslin = new ol.layer.Tile({
        source: Source_rdslin
    });
    Layer_rdslin.set('name', 'rdslin');

    var geoserver_url_local = geoserver_url;

    var url_n_19_20190506_32644 = geoserver_url_local + geoserver_workspace_name + '/wms';
    var Source_n_19_20190506_32644 = new ol.source.TileWMS({
        url: url_n_19_20190506_32644,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':n_19_20190506_32644'
        },
        serverType: 'geoserver'
    });
    var Layer_n_19_20190506_32644 = new ol.layer.Tile({
        source: Source_n_19_20190506_32644
    });
    Layer_n_19_20190506_32644.set('name', 'n_19');
    Layer_n_19_20190506_32644.set('date', 'n_19_20190506');

    var url_n_19_20190918_32644 = geoserver_url_local + geoserver_workspace_name + '/wms';
    var Source_n_19_20190918_32644 = new ol.source.TileWMS({
        url: url_n_19_20190918_32644,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':n_19_20190918_32644'
        },
        serverType: 'geoserver'
    });
    var Layer_n_19_20190918_32644 = new ol.layer.Tile({
        source: Source_n_19_20190918_32644
    });
    Layer_n_19_20190918_32644.set('name', 'n_19');
    Layer_n_19_20190918_32644.set('date', 'n_19_20190918');
    Layer_n_19_20190918_32644.setVisible(false);

    var url_n_63_20190413_32644 = geoserver_url_local + geoserver_workspace_name + '/wms';
    var Source_n_63_20190413_32644 = new ol.source.TileWMS({
        url: url_n_63_20190413_32644,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':n_63_20190413_32644'
        },
        serverType: 'geoserver'
    });
    var Layer_n_63_20190413_32644 = new ol.layer.Tile({
        source: Source_n_63_20190413_32644
    });
    Layer_n_63_20190413_32644.set('name', 'n_63');
    Layer_n_63_20190413_32644.set('date', 'n_63_20190413');

    var url_n_63_20190801_32644 = geoserver_url_local + geoserver_workspace_name + '/wms';
    var Source_n_63_20190801_32644 = new ol.source.TileWMS({
        url: url_n_63_20190801_32644,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':n_63_20190801_32644'
        },
        serverType: 'geoserver'
    });
    var Layer_n_63_20190801_32644 = new ol.layer.Tile({
        source: Source_n_63_20190801_32644
    });
    Layer_n_63_20190801_32644.set('name', 'n_63');
    Layer_n_63_20190801_32644.set('date', 'n_63_20190801');
    Layer_n_63_20190801_32644.setVisible(false);

    var url_pas19 = geoserver_url_local + geoserver_workspace_name + '/wms';
    var Source_pas19 = new ol.source.TileWMS({
        url: url_pas19,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':pas19'
        },
        serverType: 'geoserver'
    });
    var Layer_pas19 = new ol.layer.Tile({
        source: Source_pas19
    });
    Layer_pas19.set('name', 'pas19');

    var url_pas63 = geoserver_url_local + geoserver_workspace_name + '/wms';
    var Source_pas63 = new ol.source.TileWMS({
        url: url_pas63,
        params: {
            'FORMAT': 'image/png',
            'VERSION': '1.1.1',
            tiled: true,
            'LAYERS': geoserver_workspace_name + ':pas63'
        },
        serverType: 'geoserver'
    });
    var Layer_pas63 = new ol.layer.Tile({
        source: Source_pas63
    });
    Layer_pas63.set('name', 'pas63');

    var Source_select_pasturepol = new ol.source.Vector({});
    var Layer_select_pasturepol = new ol.layer.Vector({
        source: Source_select_pasturepol,
        style: new ol.style.Style({
            fill: new ol.style.Fill({
                color: [0, 0, 255, 1]
            }),
            stroke: new ol.style.Stroke({
                color: 'red',
                width: 2
            })
        })
    });
    Layer_select_pasturepol.set('name', 'pasturepol');
</script>

@* map *@
<script>
    // permalink
    var zoom = 5;
    var center = ol.proj.fromLonLat([66.902, 48.714]);
    var rotation = 0;
    if (window.location.hash !== '') {
        // try to restore center, zoom-level and rotation from the URL
        var hash = window.location.hash.replace('#map=', '');
        var parts = hash.split('/');
        if (parts.length === 4) {
            zoom = parseInt(parts[0], 10);
            center = [
                parseFloat(parts[1]),
                parseFloat(parts[2])
            ];
            rotation = parseFloat(parts[3]);
        }
    }

    var map = new ol.Map({
        target: 'map',
        controls: new ol.control.defaults({ attributionOptions: { collapsible: true } }).extend([
            new ol.control.ScaleLine()
        ]),
        layers: [
            Layer_Base,
            Layer_n_19_20190506_32644,
            Layer_n_19_20190918_32644,
            Layer_n_63_20190413_32644,
            Layer_n_63_20190801_32644,
            Layer_pas19,
            Layer_pas63,
            Layer_select_pasturepol,
            Layer_hdrlin,
            Layer_rdslin,
            Layer_adm1pol,
            Layer_adm2pol,
            Layer_adm3pol,
            Layer_poppol,
            Layer_poppnt,
            Layer_hdrpol
        ],
        view: new ol.View({
            center: center,
            zoom: 5,
            minZoom: 5,
            extent: [5028944.964937042, 4754994.655562972, 10214432.963802021, 7494497.74930296]
        })
    });

    // permalink
    var shouldUpdate = true;
    var view = map.getView();
    var updatePermalink = function () {
        if (!shouldUpdate) {
            // do not update the URL when the view was changed in the 'popstate' handler
            shouldUpdate = true;
            return;
        }
        var center = view.getCenter();
        var hash = '#map=' +
            view.getZoom() + '/' +
            Math.round(center[0] * 100) / 100 + '/' +
            Math.round(center[1] * 100) / 100 + '/' +
            view.getRotation();
        var state = {
            zoom: view.getZoom(),
            center: view.getCenter(),
            rotation: view.getRotation()
        };
        window.history.pushState(state, 'map', hash);
    };

    map.on('moveend', updatePermalink);

    window.addEventListener('popstate', function (event) {
        if (event.state === null) {
            return;
        }
        map.getView().setCenter(event.state.center);
        map.getView().setZoom(event.state.zoom);
        map.getView().setRotation(event.state.rotation);
        shouldUpdate = false;
    });

    function ToHome() {
        map.getView().fit([5028944.964937042, 4754994.655562972, 10214432.963802021, 7494497.74930296], map.getSize());
    };
</script>

@* ChangeLayers *@
<script>
    function ChangeLayers() {
        map.getLayers().forEach(function (layer) {
            if (layer.get('name') == 'Base') {
                layer.setVisible(document.getElementById("layerBaseShow").checked);
                layer.setOpacity($('#layerBaseOpacity').val() / 100)
                if ($('#layerBaseType').val() == 'OSM') {
                    layer.setSource(Source_OSM);
                }
                else if ($('#layerBaseType').val() == 'BingAerialWithLabels') {
                    layer.setSource(Source_BingAerialWithLabels);
                }
                else if ($('#layerBaseType').val() == 'BingRoadStatic') {
                    layer.setSource(Source_BingRoadStatic);
                }
                else if ($('#layerBaseType').val() == 'BingRoadDynamic') {
                    layer.setSource(Source_BingRoadDynamic);
                }
                else if ($('#layerBaseType').val() == 'HEHtmltmlmlmlENormalDay') {
                    layer.setSource(Source_HERENormalDay);
                }
                else if ($('#layerBaseType').val() == 'HERENormalDayTransit') {
                    layer.setSource(Source_HERENormalDayTransit);
                }
                else if ($('#layerBaseType').val() == 'HERETerrainDay') {
                    layer.setSource(Source_HERETerrainDay);
                }
                else if ($('#layerBaseType').val() == 'HEREHybridDay') {
                    layer.setSource(Source_HEREHybridDay);
                }
                else if ($('#layerBaseType').val() == 'StamenWatercolor') {
                    layer.setSource(Source_StamenWatercolor);
                }
                else if ($('#layerBaseType').val() == 'StamenTerrain') {
                    layer.setSource(Source_StamenTerrain);
                }
                else if ($('#layerBaseType').val() == 'StamenToner') {
                    layer.setSource(Source_StamenToner);
                }
                else if ($('#layerBaseType').val() == 'ArcGIS') {
                    layer.setSource(Source_ArcGIS);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestOpenCycleMap') {
                    layer.setSource(Source_ThunderforestOpenCycleMap);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestTransport') {
                    layer.setSource(Source_ThunderforestTransport);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestLandscape') {
                    layer.setSource(Source_ThunderforestLandscape);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestOutdoors') {
                    layer.setSource(Source_ThunderforestOutdoors);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestTransportDark') {
                    layer.setSource(Source_ThunderforestTransportDark);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestSpinalMap') {
                    layer.setSource(Source_ThunderforestSpinalMap);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestPioneer') {
                    layer.setSource(Source_ThunderforestPioneer);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestMobileAtlas') {
                    layer.setSource(Source_ThunderforestMobileAtlas);
                }
                else if ($('#layerBaseType').val() == 'ThunderforestNeighbourhood') {
                    layer.setSource(Source_ThunderforestNeighbourhood);
                }
            }
            if (layer.get('name') == 'admxpol') {
                layer.setVisible(document.getElementById("layeradmxpolShow").checked);
                layer.setOpacity($('#layeradmxpolOpacity').val() / 100);
            }
            if (layer.get('name') == 'hdr') {
                layer.setVisible(document.getElementById("layerhdrShow").checked);
                layer.setOpacity($('#layerhdrOpacity').val() / 100);
            }
            if (layer.get('name') == 'pop') {
                layer.setVisible(document.getElementById("layerpopShow").checked);
                layer.setOpacity($('#layerpopOpacity').val() / 100);
            }
            if (layer.get('name') == 'rdslin') {
                layer.setVisible(document.getElementById("layerrdslinShow").checked);
                layer.setOpacity($('#layerrdslinOpacity').val() / 100);
            }
            if (layer.get('name') == 'pas19') {
                layer.setOpacity($('#layerpas19Opacity').val() / 100);
                layer.setVisible(document.getElementById("layerpas19Show").checked);
            }
            if (layer.get('name') == 'pas63') {
                layer.setOpacity($('#layerpas63Opacity').val() / 100);
                layer.setVisible(document.getElementById("layerpas63Show").checked);
            }
            if (layer.get('name') == 'n_19') {
                layer.setOpacity($('#layern_19Opacity').val() / 100);
                layer.setVisible(layer.get('date') == $('#n_19_date').val());
                if (!document.getElementById("layern_19Show").checked) {
                    layer.setVisible(false);
                }
            }
            if (layer.get('name') == 'n_63') {
                layer.setOpacity($('#layern_63Opacity').val() / 100);
                layer.setVisible(layer.get('date') == $('#n_63_date').val());
                if (!document.getElementById("layern_63Show").checked) {
                    layer.setVisible(false);
                }
            }
        })
    }
</script>

@* map.on('singleclick') *@
<script>
    var InfoMapModal;
    $(document).ready(function () {
        InfoMapModal = new jBox('Modal', {
            id: 'modal-info',
            maxWidth: 500,
            maxHeight: 400,
            title: 'My Modal',
            zIndex: 'auto',
            draggable: 'title',
            closeOnClick: false,
            closeButton: 'title',
            animation: 'zoomIn',
            overlay: false,
            onOpen: function () {
                this.setTitle('<div class="text-white font-weight-bold">@SharedLocalizer["Information"]</div>');
            },
            onClose: function () {
                Source_select_pasturepol.clear();
            }
        });
    });
    map.on('singleclick', function (evt) {
        Source_select_pasturepol.clear();
        $('#valueGroupLat').text('');
        $('#valueUr_v').text('');
        $('#valueUr_l').text('');
        $('#valueUr_o').text('');

        $('#YieldBefore').text('');
        $('#YieldAfter').text('');

        var viewResolution = (map.getView().getResolution());
        var url_pas19 = Source_pas19.getGetFeatureInfoUrl(
            evt.coordinate, viewResolution, 'EPSG:3857',
            {
                'INFO_FORMAT': 'text/javascript'
            });
        if (url_pas19) {
            jQuery.ajax({
                jsonp: false,
                jsonpCallback: 'getJson',
                type: 'GET',
                url: url_pas19 + "&format_options=callback:getJson",
                async: false,
                dataType: 'jsonp',
                error: function () {
                }
            }).then(function (data) {
                if (Layer_pas19.getVisible() && data.features.length > 0) {
                    // select pasture
                    var polyFeature = new ol.Feature({
                        geometry: new ol.geom.MultiPolygon(data.features[0].geometry.coordinates)
                    });
                    Source_select_pasturepol.addFeature(polyFeature);
                    // data from pasturepol
                    var parser = new ol.format.GeoJSON();
                    var features = parser.readFeatures(data);
                    switch (features[0].get('number')) {
                        case 0:
                            $('#YieldBefore').text('1,5');
                            $('#YieldAfter').text('9,0');
                            InfoMapModal.setContent($('#InfoMapDegradation'));
                            InfoMapModal.open();
                            break;
                        case 1:
                            $('#valueGroupLat').text('Artemisia Sublessigina + Ephemeral + Ceratocarpus.l');
                            $('#valueUr_v').text('16,7');
                            $('#valueUr_l').text('13,1');
                            $('#valueUr_o').text('9,5');
                            InfoMapModal.setContent($('#InfoMap'));
                            InfoMapModal.open();
                            break;
                        case 2:
                            $('#valueGroupLat').text('Ephemeral + Artemisia Gublessigina + Ceratocarpus.l');
                            $('#valueUr_v').text('13,6');
                            $('#valueUr_l').text('11,1');
                            $('#valueUr_o').text('7,7');
                            InfoMapModal.setContent($('#InfoMap'));
                            InfoMapModal.open();
                            break;
                        case 3:
                            $('#valueGroupLat').text('Ceratocarpus.l + Artemisia Sublessigina + Ephemeral');
                            $('#valueUr_v').text('8,0');
                            $('#valueUr_l').text('7,0');
                            $('#valueUr_o').text('4,5');
                            InfoMapModal.setContent($('#InfoMap'));
                            InfoMapModal.open();
                            break;
                        default:
                    }
                }
                var url_pas63 = Source_pas63.getGetFeatureInfoUrl(
                    evt.coordinate, viewResolution, 'EPSG:3857',
                    {
                        'INFO_FORMAT': 'text/javascript'
                    });
                if (url_pas63) {
                    jQuery.ajax({
                        jsonp: false,
                        jsonpCallback: 'getJson',
                        type: 'GET',
                        url: url_pas63 + "&format_options=callback:getJson",
                        async: false,
                        dataType: 'jsonp',
                        error: function () {
                        }
                    }).then(function (data) {
                        if (Layer_pas63.getVisible() && data.features.length > 0) {
                            // select pasture
                            var polyFeature = new ol.Feature({
                                geometry: new ol.geom.MultiPolygon(data.features[0].geometry.coordinates)
                            });
                            Source_select_pasturepol.addFeature(polyFeature);
                            // data from pasturepol
                            var parser = new ol.format.GeoJSON();
                            var features = parser.readFeatures(data);
                            switch (features[0].get('number')) {
                                case 0:
                                    $('#YieldBefore').text('7,4');
                                    $('#YieldAfter').text('11,1');
                                    InfoMapModal.setContent($('#InfoMapDegradation'));
                                    InfoMapModal.open();
                                    break;
                                case 1:
                                    $('#valueGroupLat').text('Festuca Sulcata + Artemisia Sublessigina + Stipa Capillata');
                                    $('#valueUr_v').text('12,1');
                                    $('#valueUr_l').text('15,4');
                                    $('#valueUr_o').text('11,8');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                case 2:
                                    $('#valueGroupLat').text('Festuca Sulcata + Stipa Capillata + Artemisia Sublessigina + Caragana Pumila');
                                    $('#valueUr_v').text('17,1');
                                    $('#valueUr_l').text('20,0');
                                    $('#valueUr_o').text('15,2');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                case 3:
                                    $('#valueGroupLat').text('Festuca Sulcata + Stipa Capillata + Artemisia Sublessigina + Caragana Pumila + Spiraea Hypericifolia)');
                                    $('#valueUr_v').text('17,4');
                                    $('#valueUr_l').text('22,7');
                                    $('#valueUr_o').text('15,8');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                case 4:
                                    $('#valueGroupLat').text('Artemisia Sublessigina + Festuca Sulcate + Agropyrum Repens');
                                    $('#valueUr_v').text('16,0');
                                    $('#valueUr_l').text('19,1');
                                    $('#valueUr_o').text('14,6');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                case 5:
                                    $('#valueGroupLat').text('Festuca Sulcata + Artemisia Sublessigina + Caragana Pumila');
                                    $('#valueUr_v').text('16,7');
                                    $('#valueUr_l').text('20,1');
                                    $('#valueUr_o').text('15,7');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                case 6:
                                    $('#valueGroupLat').text('Festuca Sulcata + Artemisia Sublessigina + Caragana Pumila + Spiraea Hypericifolia');
                                    $('#valueUr_v').text('14,1');
                                    $('#valueUr_l').text('17,7');
                                    $('#valueUr_o').text('14,0');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                case 7:
                                    $('#valueGroupLat').text('Agropyrum repens + Festuca Sulcata + Artemisia Sublessigina');
                                    $('#valueUr_v').text('17,0');
                                    $('#valueUr_l').text('21,5');
                                    $('#valueUr_o').text('14,8');
                                    InfoMapModal.setContent($('#InfoMap'));
                                    InfoMapModal.open();
                                    break;
                                default:
                            }
                        }
                    });
                }
            });
        }
    })
</script>

@* CATO *@
<script>
    var cato = new Array();
    @foreach (CATO cATO in ViewBag.CATO)
    {

        @:var cato_new = {};
        @:cato_new["te"] = '@cATO.TE';
        @:cato_new["ab"] = '@cATO.AB';
        @:cato_new["cd"] = '@cATO.CD';
        @:cato_new["ef"] = '@cATO.EF';
        @:cato_new["hij"] = '@cATO.HIJ';
        @:cato_new["name"] = '@Html.Raw(cATO.Name)';
        @:cato.push(cato_new);
    }
    $('#cato1').append($("<option />"));
    $('#catosearch1').append($("<option />"));
    $.each(cato, function () {
        if (this.cd == '00' && (this.ab == '19' || this.ab == '63')) {
            $('#cato1').append($("<option />").val(this.te).text(this.name));
            $('#catosearch1').append($("<option />").val(this.te).text(this.name));
        }
    });

    function ChangeCATO1() {
        NavigateToCATO($('#cato1').val(), 1);
        var ab = $('#cato1').val().substr(0, 2);
        $('#cato2').empty();
        $('#cato3').empty();
        $('#cato2').append($("<option />"));
        $.each(cato, function () {
            if (this.ef == '00' && this.ab == ab && this.cd != '00') {
                $('#cato2').append($("<option />").val(this.te).text(this.name));
            }
        });
    }

    function ChangeCATO2() {
        NavigateToCATO($('#cato2').val(), 2);
        var ab = $('#cato2').val().substr(0, 2),
            cd = $('#cato2').val().substr(2, 2);
        $('#cato3').empty();
        $('#cato3').append($("<option />"));
        $.each(cato, function () {
            if (this.hij == '000' && this.ab == ab && this.cd == cd && this.ef != '00') {
                $('#cato3').append($("<option />").val(this.te).text(this.name));
            }
        });
    }

    function ChangeCATO3() {
        NavigateToCATO($('#cato3').val(), 3);
    }

    function ChangeCATOsearch1() {
        NavigateToCATO($('#catosearch1').val(), 1);
        var ab = $('#catosearch1').val().substr(0, 2);
        $('#catosearch2').empty();
        $('#catosearch3').empty();
        $('#catosearch2').append($("<option />"));
        $.each(cato, function () {
            if (this.ef == '00' && this.ab == ab && this.cd != '00' && (this.te == '191600000' || this.te == '633400000')) {
                $('#catosearch2').append($("<option />").val(this.te).text(this.name));
                console.log(this.te);
            }
        });
    }

    function ChangeCATOsearch2() {
        NavigateToCATO($('#catosearch2').val(), 2);
        var ab = $('#catosearch2').val().substr(0, 2),
            cd = $('#catosearch2').val().substr(2, 2);
        $('#catosearch3').empty();
        $('#catosearch3').append($("<option />"));
        $.each(cato, function () {
            if (this.hij == '000' && this.ab == ab && this.cd == cd && this.ef != '00' && (this.te == '191637000' || this.te == '633467000')) {
                $('#catosearch3').append($("<option />").val(this.te).text(this.name));
            }
        });
    }

    function ChangeCATOsearch3() {
        NavigateToCATO($('#catosearch3').val(), 3);
    }

    var first_admXpol_Navigate = true;
    function NavigateToCATO(te, layer) {
        if (Layer_admXpol_Navigate.getSource() != null) {
            Layer_admXpol_Navigate.getSource().clear();
        }
        if (te == '') {
            return;
        }
        var filter = "kato_te = '" + te + "'";
        var filterParams = {
            'FILTER': null,
            'CQL_FILTER': null,
            'FEATUREID': null
        };
        if (filter.replace(/^\s\s*/, '').replace(/\s\s*$/, '') != "") {
            filterParams["CQL_FILTER"] = filter;
        }
        url_admXpol_Navigate = geoserver_url + geoserver_workspace_name + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geoserver_workspace_name + ":adm" + layer.toString() + "pol&CQL_FILTER=" + filter + "&outputFormat=text/javascript&format_options=callback:getJson";
        $.ajax({
            jsonp: false,
            jsonpCallback: 'getJson',
            type: 'GET',
            url: url_admXpol_Navigate,
            async: false,
            dataType: 'jsonp',
            success: function (data_admXpol_Navigate) {
                var new_source = new ol.source.Vector({
                    features: (new ol.format.GeoJSON()).readFeatures(data_admXpol_Navigate, {
                        featureProjection: 'EPSG:3857'
                    })
                });
                Layer_admXpol_Navigate.setSource(new_source);
                map.getView().fit(Layer_admXpol_Navigate.getSource().getExtent());
                if (first_admXpol_Navigate) {
                    map.addLayer(Layer_admXpol_Navigate);
                    first_admXpol_Navigate = false;
                }
            }
        });
    }
</script>

@* FindPastures *@
<script>
    $(document).ready(function () {
        new jBox('Modal', {
            attach: '#FilterPastureBtn',
            width: 400,
            zIndex: 'auto',
            draggable: 'title',
            closeOnClick: false,
            closeButton: 'title',
            animation: 'slide',
            title: '@SharedLocalizer["PastureSearch"]',
            content: $('#FilterPasture'),
            overlay: false,
            position: {
                x: 'left',
                y: 'center'
            },
            offset: {
                x: 300
            },
        });
    });

    function FindPastures() {
        var otdely_id = $('#find_otdel').val(),
            class_id = $('#find_ptype').val(),
            group_id = $('#find_soob').val(),
            //ur_v_from = $('#find_ur_v_from').val().replace(',', '.'),
            //ur_v_to = $('#find_ur_v_to').val().replace(',', '.'),
            //ur_l_from = $('#find_ur_l_from').val().replace(',', '.'),
            //ur_l_to = $('#find_ur_l_to').val().replace(',', '.'),
            //ur_o_from = $('#find_ur_o_from').val().replace(',', '.'),
            //ur_o_to = $('#find_ur_o_to').val().replace(',', '.'),
            //ur_z_from = $('#find_ur_z_from').val().replace(',', '.'),
            //ur_z_to = $('#find_ur_z_to').val().replace(',', '.'),
            recommend = $('#find_recommend').val(),
            recomcattle = $('#find_recomcattle').val();
        filter_found = '';
        if (otdely_id != '') {
            if (filter_found.length == 0) {
                filter_found = "otdely_id = '" + otdely_id + "'";
            }
            else {
                filter_found += " && otdely_id = '" + otdely_id + "'";
            }
        }
        if (class_id != '') {
            if (filter_found.length == 0) {
                filter_found = "class_id = '" + class_id + "'";
            }
            else {
                filter_found += " && class_id = '" + class_id + "'";
            }
        }
        if (group_id != '') {
            if (filter_found.length == 0) {
                filter_found = "group_id = '" + group_id + "'";
            }
            else {
                filter_found += " && group_id = '" + group_id + "'";
            }
        }
        //if (ur_v_from != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_v >= " + ur_v_from + "";
        //    }
        //    else {
        //        filter_found += " && ur_v >= " + ur_v_from + "";
        //    }
        //}
        //if (ur_v_to != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_v <= " + ur_v_to + "";
        //    }
        //    else {
        //        filter_found += " && ur_v <= " + ur_v_to + "";
        //    }
        //}
        //if (ur_l_from != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_l >= " + ur_l_from + "";
        //    }
        //    else {
        //        filter_found += " && ur_l >= " + ur_l_from + "";
        //    }
        //}
        //if (ur_l_to != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_l <= " + ur_l_to + "";
        //    }
        //    else {
        //        filter_found += " && ur_l <= " + ur_l_to + "";
        //    }
        //}
        //if (ur_o_from != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_o >= " + ur_o_from + "";
        //    }
        //    else {
        //        filter_found += " && ur_o >= " + ur_o_from + "";
        //    }
        //}
        //if (ur_o_to != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_o <= " + ur_o_to + "";
        //    }
        //    else {
        //        filter_found += " && ur_o <= " + ur_o_to + "";
        //    }
        //}
        //if (ur_z_from != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_z >= " + ur_z_from + "";
        //    }
        //    else {
        //        filter_found += " && ur_z >= " + ur_z_from + "";
        //    }
        //}
        //if (ur_z_to != '') {
        //    if (filter_found.length == 0) {
        //        filter_found = "ur_z <= " + ur_z_to + "";
        //    }
        //    else {
        //        filter_found += " && ur_z <= " + ur_z_to + "";
        //    }
        //}
        if (recommend != '') {
            if (filter_found.length == 0) {
                filter_found = "recommend_ = '" + recommend + "'";
            }
            else {
                filter_found += " && recommend_ = '" + recommend + "'";
            }
        }
        if (recomcattle != '') {
            if (filter_found.length == 0) {
                filter_found = "recom_catt = '" + recomcattle + "'";
            }
            else {
                filter_found += " && recom_catt = '" + recomcattle + "'";
            }
        }
        if (filter_found.length == 0) {
            filter_found = "otdely_id = 'none'";
        }
        filterParams_found = {
            'FILTER': null,
            'CQL_FILTER': null,
            'FEATUREID': null
        };
        if (filter_found.replace(/^\s\s*/, '').replace(/\s\s*$/, '') != "") {
            filterParams_found["CQL_FILTER"] = filter_found;
        }
        Layer_found_pasturepol.getSource().updateParams(filterParams_found);
        Layer_found_pasturepol.getSource().refresh();
    }
</script>

@* InfoCATO, ChartCATO, TableCATO *@
<script>
    var ctx = null;
    var chart = null;
    var InfoChartModal;
    function random_rgba() {
        var o = Math.round, r = Math.random, s = 255;
        return 'rgba(' + o(r() * s) + ',' + o(r() * s) + ',' + o(r() * s) + ',' + r().toFixed(1) + ')';
    }

    $(document).ready(function () {
        new jBox('Modal', {
            attach: '#FilterKATOBtn',
            width: 300,
            zIndex: 'auto',
            draggable: 'title',
            closeOnClick: false,
            closeButton: 'title',
            animation: 'slide',
            title: '@SharedLocalizer["FreeInformation"]',
            content: $('#FilterKato'),
            overlay: false,
            position: {
                x: 'left',
                y: 'center'
            },
            offset: {
                x: 300
            },
            onOpen: function () {
                this.setTitle('<div class="ajax-complete">@SharedLocalizer["FreeInformation"]</div>');
            },
        });
        $('#FilterChart').on('click', function () {
            InfoChartModal.open()
        });
    });
    $(document).ready(function () {
        InfoChartModal = new jBox('Modal', {
            id: 'modal-white',
            width: 600,
            maxHeight: 500,
            zIndex: 'auto',
            closeButton: 'title',
            animation: 'pulse',
            draggable: 'title',
            overlay: false,
            reload: 'strict',
            position: {
                x: 'right',
                y: 'top'
            },
            offset: {
                x: -10,
                y: 170
            },
            onOpen: function () {
                this.setContent($('#InfoKatoTabContent'));
                this.setTitle($('#InfoKatoTab'));
            },
        });
    });

    function InfoCATO() {
        var te = $('#cato3').val(),
            te1 = $('#cato1').val(),
            te2 = $('#cato2').val(),
            te3 = $('#cato3').val();
        if (te3 == '') {
            te = te2;
        }
        if (te2 == '') {
            te = te1;
        }
        $.ajax({
            url: '@Url.Action("GetCATOPastureInfo")',
            data: { catote: te },
            type: 'POST',
            success: function (data) {
                ChartCATO(data.pasturepols_otdels);
                TableCATO(data.pasturepols_classes);
            },
            error: function () {
            }
        });
    }
    function ChartCATO(pasturepols) {
        ctx = document.getElementById('chart').getContext('2d');
        var title = $('#cato1 option:selected').text();
        if ($('#cato2 option:selected').text() != '') {
            title += ', ' + $('#cato2 option:selected').text()
        }
        if ($('#cato3 option:selected').text() != '') {
            title += ', ' + $('#cato3 option:selected').text()
        }
        var config = {
            type: 'pie',
            data: {
                datasets: [{
                    data: [],
                    backgroundColor: [],
                    borderColor: '#002867',
                    borderWidth: 1,
                    label: 'Dataset 1'
                }],
                labels: []
            },
            options: {
                responsive: true,
                legend: {
                    position: 'bottom',
                    align: 'start',
                    display: true,
                    labels: {
                        fontColor: 'rgb(0, 0, 0)'
                    }
                },
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var dataset = data.datasets[tooltipItem.datasetIndex];
                            var meta = dataset._meta[Object.keys(dataset._meta)[0]];
                            var total = meta.total;
                            var currentValue = dataset.data[tooltipItem.index];
                            var percentage = parseFloat((currentValue / total * 100).toFixed(1));
                            return percentage + '%';
                        },
                        title: function (tooltipItem, data) {
                            return data.labels[tooltipItem[0].index];
                        }
                    }
                },
                title: {
                    display: true,
                    text:  title
                }
            }
        };
        for (var i = 0; i < pasturepols.length; ++i) {
            config.data.datasets[0].data.push(pasturepols[i].shape_area);
            config.data.datasets[0].backgroundColor.push(random_rgba());
            config.data.labels.push($("#find_otdel option[value=" + pasturepols[i].otdely_id + "]").text());
        }

        if (chart != null) {
            chart.destroy();
        }
        chart = new Chart(ctx, config);
    }
    function TableCATO(pasturepols) {
        var title = $('#cato1 option:selected').text();
        if ($('#cato2 option:selected').text() != '') {
            title += ', ' + $('#cato2 option:selected').text()
        }
        if ($('#cato3 option:selected').text() != '') {
            title += ', ' + $('#cato3 option:selected').text()
        }
        $('#table_info_ptype tr').remove();
        var content = '<tr><th colspan="2">' + title + '</th></tr>';
        for (var i = 0; i < pasturepols.length; ++i) {
            content += '<tr>'+'<td>' + pasturepols[i].percent.toFixed(2) + "%"+'\t'+'</td>'
            + '<td>' + $("#find_ptype option[value=" + pasturepols[i].class_id + "]").text() + '</td>'+ '</tr>';
        }
        content += ""
        $('#table_info_ptype').append(content);
    }
    //add button to generate PDF
    function saveAsPDF() {
        html2canvas(document.getElementById("chart"), {
            onrendered: function (canvas) {
                // get size of report page
                var reportPageHeight = 380;
                var reportPageWidth = 430;
                var img = canvas.toDataURL(); //image data of canvas
                var doc = new jsPDF('a4', 'pt', [reportPageWidth, reportPageHeight]);
                doc.addImage(img, 10, 10);
                doc.save('test.pdf');
            }
        });
    }
    // function for export table
    var $table_ptype = $('#table_info_ptype')
    var $excel_ptype = $('#excel_ptype')
    var $txt_ptype = $('#txt_ptype')
    $(function () {
        $excel_ptype.click(function () {
            $('#table_info_ptype').tableExport({
                type: 'excel'
            });
        })
        $txt_ptype.click(function () {
            $('#table_info_ptype').tableExport({
                type: 'txt'
            });
        })

    })
</script>

@*Sidebar Menu*@
<script>
    jQuery(document).ready(function () {
        /* Sidebar */
        $('.dismiss, .overlay').on('click', function () {
            $('.sidebar').removeClass('active');
        });

        $('.open-menu').on('click', function (e) {
            e.preventDefault();
            $('.sidebar').addClass('active');
            // close opened sub-menus
            $('.collapse.show').toggleClass('show');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });
        /* change sidebar style */
        $('a.btn-customized-dark').on('click', function (e) {
            e.preventDefault();
            $('.sidebar').removeClass('light');
        });
        $('a.btn-customized-light').on('click', function (e) {
            e.preventDefault();
            $('.sidebar').addClass('light');
        });
    });
</script>

@*tooltips, modal windows*@
<script>
    $(document).ready(function () {
        // Map Title
        new jBox('Modal', {
            attach: '#MapTitleBtn',
            theme: 'TooltipBorder',
            width: 260,
            animation: 'flip',
            closeButton: false,
            position: {
                x: 'right',
                y: 'top'
            },
            offset: {
                x: -10,
                y: 70
            },
            content: (
                '<h5 class="Card-title text-center text-white">@SharedLocalizer["FAOTitle"]</h5>' +
                '<p class="card-text text-center text-white">@SharedLocalizer["FAOText"]</p>'
            ),
            overlay: false,
        }).open();

        // Map Legend
        new jBox('Modal', {
            attach: '#LegendBtn2',
            theme: 'TooltipBorder',
            width: 500,
            maxHeight: 500,
            zIndex: 'auto',
            closeButton: true,
            overlay: false,
            reload: 'strict',
            animation: 'flip',
            adjustPosition: false,
            closeButton: true,
            draggable: true,
            position: {
                x: 'right',
                y: 'top'
            },
            offset: {
                x: -10,
                y: 300
            },
            onOpen: function () {
                this.setContent("@Html.Raw(legendhtml)");
            }
        });

        // Tooltip below to the right
        new jBox('Tooltip', {
            theme: 'TooltipDark',
            attach: '.SomeInfo',
            getTitle: 'InfoTitle',
            closeOnMouseleave: true,
            pointer: 'center:-20',
            maxWidth: 400,
            minWidth: 100,
            adjustPosition: true,
            adjustTracker: true
        });
    });
</script>

@*Word wrap options in a select list*@
<script>
    var optionText, array = [], newString, maxChar = 70;
    $('select').each(function () {
        $(this).find('option').each(function (i, e) {
            $(e).attr('title', $(e).text());
            optionText = $(e).text();
            newString = '';
            if (optionText.length > maxChar) {
                array = optionText.split(' ');
                $.each(array, function (ind, ele) {
                    newString += ele + ' ';
                    if (ind > 0 && newString.length > maxChar) {
                        $(e).text(newString);
                        return false;
                    }
                });
            }
        });
    });
</script>